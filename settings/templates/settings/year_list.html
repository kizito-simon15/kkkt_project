{% extends 'base.html' %}

{% block content %}
<div style="
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    min-height: 100vh;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    padding: 0;
    box-sizing: border-box;
    gap: 20px;
    width: 100%;
    overflow-x: hidden;
">
    <!-- Header Row with Back Button, Title, and Menu Button -->
    <div style="
        display: flex;
        align-items: center;
        justify-content: space-between;
        width: 100%;
        max-width: 100%;
        margin-bottom: 20px;
        padding: 20px 10px 0;
        box-sizing: border-box;
        gap: 10px;
    ">
        <button onclick="window.history.back()" style="
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(12px, 2.5vw, 14px);
            font-weight: bold;
            color: #007bff;
            padding: 8px 12px;
            border-radius: 20px;
            background: linear-gradient(130deg, #e3f2fd, #bbdefb);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            border: none;
            cursor: pointer;
            transition: background 0.3s ease, transform 0.2s ease;
            white-space: nowrap;
            flex-shrink: 0;
        " onmouseover="this.style.background='linear-gradient(130deg, #bbdefb, #bbdefb)'; this.style.transform='scale(1.05)'" onmouseout="this.style.background='linear-gradient(130deg, #e3f2fd, #bbdefb)'; this.style.transform='scale(1)'">
            <span style="font-size: clamp(16px, 3vw, 20px);">â¬…ï¸</span>
        </button>

        <h2 style="
            font-size: clamp(18px, 4vw, 24px);
            font-weight: bold;
            color: #007bff;
            margin: 0;
            flex-grow: 1;
            text-align: center;
            white-space: normal;
        ">
            ğŸ—“ï¸ Year List
        </h2>

        {% include 'accounts/partials/menu_button_partial.html' %}
    </div>

    <!-- Create New Year Button -->
    <a href="{% url 'create_year' %}" style="
        font-size: 16px;
        font-weight: bold;
        background: linear-gradient(130deg, #28a745, #218838);
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 25px;
        text-decoration: none;
        text-align: center;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transition: background 0.3s ease, transform 0.2s ease;
        margin: 0;
    " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
        â• Create New Year
    </a>

    <!-- Total Years Count -->
    <h3 style="
        font-size: 18px;
        font-weight: bold;
        color: #28a745;
        text-align: center;
        margin: 0;
    ">
        ğŸ† Total Years: <strong id="total-years-display">{{ years.count }}</strong>
    </h3>

    <!-- Search Section -->
    <div style="
        display: flex;
        justify-content: center;
        width: 100%;
        margin-bottom: 10px;
    ">
        <input type="text" id="search-year" placeholder="ğŸ” Search by Year" style="
            flex: 1;
            padding: 10px;
            border-radius: 20px;
            border: 1px solid #ccc;
            width: 100%;
            max-width: 100vw;
            box-sizing: border-box;
            text-align: center;
            font-size: 16px;
        ">
    </div>

    {% if years %}
        <!-- Full-Width Table Wrapper -->
        <div style="width: 100%; overflow-x: auto;">
            <table id="year-table" style="
                width: 100%;
                border-collapse: collapse;
                border: 1px solid #ddd;
                text-align: left;
                margin: 0;
            ">
                <thead>
                    <tr style="
                        font-weight: bold;
                        text-transform: uppercase;
                        border-bottom: 2px solid #ddd;
                    ">
                        <th style="padding: 10px; white-space: nowrap; border-right: 1px solid #ddd;">S/N</th>
                        <th style="padding: 10px; white-space: nowrap; border-right: 1px solid #ddd;">ğŸ“† Year</th>
                        <th style="padding: 10px; white-space: nowrap; border-right: 1px solid #ddd;">ğŸ“… Date Created</th>
                        <th style="padding: 10px; white-space: nowrap; border-right: 1px solid #ddd;">â³ Time Since Created</th>
                        <th style="padding: 10px; white-space: nowrap; border-right: 1px solid #ddd;">âœ… Current</th>
                        <th style="padding: 10px; white-space: nowrap;">âš™ï¸ Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for year in years %}
                        <tr style="border-bottom: 1px solid #ddd;">
                            <td style="padding: 10px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; border-right: 1px solid #ddd;">{{ forloop.counter }}</td>
                            <td style="padding: 10px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; border-right: 1px solid #ddd;" class="year-value">ğŸ“† {{ year.year }}</td>
                            <td style="padding: 10px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; border-right: 1px solid #ddd;">ğŸ“… {{ year.date_created|date:"F d, Y" }}</td>
                            <td style="padding: 10px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; border-right: 1px solid #ddd;">â³ {{ year.time_since_created }}</td>
                            <td style="padding: 10px; white-space: nowrap; border-right: 1px solid #ddd;">
                                {% if year.is_current %}
                                    âœ… Yes
                                {% else %}
                                    âŒ No
                                {% endif %}
                            </td>
                            <td style="padding: 10px; white-space: nowrap;">
                                <a href="{% url 'update_year' year.pk %}" style="color: #ffc107; text-decoration: none; font-size: 16px; margin-right: 10px;" title="Edit">âœï¸</a>
                                <a href="{% url 'delete_year' year.pk %}" style="color: #f44336; text-decoration: none; font-size: 16px;" title="Delete">ğŸ—‘ï¸</a>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <p style="color: #555; margin-top: 20px;">
            No years found. 
            <a href="{% url 'create_year' %}" style="color: #007bff; text-decoration: none;">Create a Year</a>
        </p>
    {% endif %}
</div>

<!-- JavaScript for Real-Time Filtering -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const searchYearInput = document.getElementById('search-year');
        const table = document.getElementById('year-table');
        const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
        const totalYearsDisplay = document.getElementById('total-years-display');

        function updateFilteredCount() {
            let filteredCount = 0;

            const query = searchYearInput.value.toLowerCase();

            for (let row of rows) {
                const yearValue = row.querySelector('.year-value').textContent.toLowerCase().replace('ğŸ“†', '').trim();

                if (yearValue.includes(query)) {
                    row.style.display = '';
                    filteredCount++;
                } else {
                    row.style.display = 'none';
                }
            }

            totalYearsDisplay.textContent = filteredCount;
        }

        searchYearInput.addEventListener('input', updateFilteredCount);

        // Initialize the count on page load
        updateFilteredCount();
    });
</script>

{% endblock %}