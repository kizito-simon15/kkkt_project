{% load static %}

<nav class="navbar" id="topbar"
     style="
       position: fixed !important;
       bottom: 0 !important;
       top: auto !important;
       left: 0 !important;
       right: 0 !important;
       z-index: 9999 !important;

       height: 60px !important; 
       padding: 10px 15px !important;
       box-sizing: border-box;
       max-width: 100vw;
       overflow: hidden;

       /* Default gradient, can override via --topbar-background */
       background: var(--topbar-background, linear-gradient(130deg, #0f3443, #34e89e)) !important;
       color: var(--topbar-text-color, #fff) !important;
       border-top-left-radius: 25px;
       border-top-right-radius: 25px;
       box-shadow: 0px -4px 15px rgba(0, 0, 0, 0.15) !important;
       display: flex;
       align-items: center;
       justify-content: space-between;
     ">
    <div class="container-fluid d-flex align-items-center justify-content-between flex-nowrap"
         style="width: 100%; padding: 0;">
        <!-- Left Side: Church Logo (preloaded via JS) -->
        <div class="d-flex align-items-center">
            <img 
              id="churchLogoImg" 
              alt="Church Logo" 
              width="40" 
              height="40" 
              class="rounded-circle shadow-sm"
              style="display: none;"
            >
            <span class="cms-title ms-2" style="
                font-weight: bold;
                font-size: 18px;
                color: var(--text-color, #fff);
            ">CMS</span>
        </div>

        <!-- Center: Scrolling Marquee Message -->
        <div class="marquee-container" style="
            overflow: hidden;
            white-space: nowrap;
            flex-grow: 1;
            max-width: 55%;
            text-align: center;
        ">
            <div class="marquee" style="
                display: inline-block;
                padding-left: 100%;
                animation: scrollText 10s linear infinite;
                font-weight: bold;
                color: var(--marquee-color, #f8f9fa);
            ">
                üåä Welcome to the Church Management System! Stay connected with updates. ‚ù§Ô∏è Like, üîÑ Share, and üí¨ Comment! üôè
            </div>
        </div>

        <!-- Right Side: Mode Selector instead of single Dark Mode Toggle -->
        <div class="d-flex align-items-center flex-nowrap" style="gap: 8px;">
            <select id="modeSelector" style="
                font-size: 14px; 
                padding: 4px; 
                border-radius: 6px;
                border: none;
                cursor: pointer;
            ">
                <option value="light">Light Mode</option>
                <option value="dark">Dark Mode</option>
                <option value="blue">Blue Mode</option>
                <option value="sepia">Sepia Mode</option>
                <option value="green">Green Mode</option>
                <option value="contrast">High Contrast</option>
                <option value="orange">Orange Mode</option>
                <option value="purple">Purple Mode</option>
                <option value="yellow">Yellow Mode</option>
                <option value="aqua">Aqua Mode</option>
                <option value="custom">Custom Mode</option>
            </select>
        </div>
    </div>
</nav>

<!-- Custom mode color pickers (hidden by default) -->
<div id="customPicker" 
     style="
       display: none; 
       position: fixed; 
       bottom: 70px; 
       right: 10px; 
       background-color: #fff; 
       padding: 10px; 
       border-radius: 8px; 
       box-shadow: 0 2px 5px rgba(0,0,0,0.2); 
       font-family: sans-serif;
       z-index: 10000;
     ">
  <label style="margin-right: 8px; font-size: 14px;">
    BG Color <input type="color" id="customBgInput" style="vertical-align: middle;">
  </label>
  <label style="margin-right: 8px; font-size: 14px;">
    Text Color <input type="color" id="customTextInput" style="vertical-align: middle;">
  </label>
  <button id="customApplyBtn" 
          style="
            padding: 5px 10px; 
            border-radius: 4px; 
            background-color: #007bff; 
            color: #fff; 
            border: none; 
            cursor: pointer;
            font-size: 14px;
          ">
    Apply
  </button>
</div>

<style>
    /* Keyframes for marquee text scroll */
    @keyframes scrollText {
        from { transform: translateX(0%); }
        to { transform: translateX(-100%); }
    }
</style>

<script>
    /********************************/
    /* 1) Preload Church Logo Image */
    /********************************/
    const churchLogoUrl = "{% static 'images/church.png' %}";
    const preloadedChurchLogo = new Image();
    preloadedChurchLogo.src = churchLogoUrl;

    preloadedChurchLogo.onload = function() {
      const churchLogoImg = document.getElementById('churchLogoImg');
      churchLogoImg.src = preloadedChurchLogo.src;
      churchLogoImg.style.display = 'block';  // show once loaded
    };

    /************************************/
    /* 2) Retrieve or default to 'light' */
    /************************************/
    const savedMode = localStorage.getItem('churchUiMode') || 'light';

    // If user is in Custom mode, retrieve saved colors or default
    const savedCustomBg = localStorage.getItem('churchCustomBg') || '#ffffff';
    const savedCustomText = localStorage.getItem('churchCustomText') || '#000000';

    /****************************************/
    /* 3) Function to apply a chosen mode   */
    /****************************************/
    function applyMode(mode) {
      switch (mode) {
        case 'dark':
          document.documentElement.style.setProperty('--background-color', '#121212');
          document.documentElement.style.setProperty('--text-color', '#fff');
          document.documentElement.style.setProperty('--topbar-background', 'linear-gradient(130deg, #333, #222)');
          document.documentElement.style.setProperty('--topbar-text-color', '#fff');
          document.documentElement.style.setProperty('--marquee-color', '#f1c40f');
          break;

        case 'blue':
          document.documentElement.style.setProperty('--background-color', '#E7F3FF');
          document.documentElement.style.setProperty('--text-color', '#000');
          document.documentElement.style.setProperty('--topbar-background', 'linear-gradient(130deg, #0066CC, #003366)');
          document.documentElement.style.setProperty('--topbar-text-color', '#fff');
          document.documentElement.style.setProperty('--marquee-color', '#000');
          break;

        case 'sepia':
          document.documentElement.style.setProperty('--background-color', '#F5E9DA');
          document.documentElement.style.setProperty('--text-color', '#5B4636');
          document.documentElement.style.setProperty('--topbar-background', 'linear-gradient(130deg, #C2A782, #9D8B6E)');
          document.documentElement.style.setProperty('--topbar-text-color', '#fff');
          document.documentElement.style.setProperty('--marquee-color', '#5B4636');
          break;

        case 'green':
          document.documentElement.style.setProperty('--background-color', '#E7FFE7');
          document.documentElement.style.setProperty('--text-color', '#004400');
          document.documentElement.style.setProperty('--topbar-background', 'linear-gradient(130deg, #00AA00, #008800)');
          document.documentElement.style.setProperty('--topbar-text-color', '#fff');
          document.documentElement.style.setProperty('--marquee-color', '#004400');
          break;

        case 'contrast':
          document.documentElement.style.setProperty('--background-color', '#000');
          document.documentElement.style.setProperty('--text-color', '#fff');
          document.documentElement.style.setProperty('--topbar-background', 'linear-gradient(130deg, #000, #000)');
          document.documentElement.style.setProperty('--topbar-text-color', '#fff');
          document.documentElement.style.setProperty('--marquee-color', '#ff0');
          break;

        case 'orange':
          document.documentElement.style.setProperty('--background-color', '#FFF5E6');
          document.documentElement.style.setProperty('--text-color', '#CC6600');
          document.documentElement.style.setProperty('--topbar-background', 'linear-gradient(130deg, #FF9900, #CC6600)');
          document.documentElement.style.setProperty('--topbar-text-color', '#fff');
          document.documentElement.style.setProperty('--marquee-color', '#CC6600');
          break;

        case 'purple':
          document.documentElement.style.setProperty('--background-color', '#F7F0FF');
          document.documentElement.style.setProperty('--text-color', '#4B0082');
          document.documentElement.style.setProperty('--topbar-background', 'linear-gradient(130deg, #8A2BE2, #4B0082)');
          document.documentElement.style.setProperty('--topbar-text-color', '#fff');
          document.documentElement.style.setProperty('--marquee-color', '#4B0082');
          break;

        case 'yellow':
          document.documentElement.style.setProperty('--background-color', '#FFFFE0');
          document.documentElement.style.setProperty('--text-color', '#666600');
          document.documentElement.style.setProperty('--topbar-background', 'linear-gradient(130deg, #FFFF00, #CCCC00)');
          document.documentElement.style.setProperty('--topbar-text-color', '#fff');
          document.documentElement.style.setProperty('--marquee-color', '#666600');
          break;

        case 'aqua':
          document.documentElement.style.setProperty('--background-color', '#E0FFFF');
          document.documentElement.style.setProperty('--text-color', '#006666');
          document.documentElement.style.setProperty('--topbar-background', 'linear-gradient(130deg, #00FFFF, #00CCCC)');
          document.documentElement.style.setProperty('--topbar-text-color', '#fff');
          document.documentElement.style.setProperty('--marquee-color', '#006666');
          break;

        case 'custom':
          document.documentElement.style.setProperty('--background-color', savedCustomBg);
          document.documentElement.style.setProperty('--text-color', savedCustomText);
          document.documentElement.style.setProperty('--topbar-background', 'linear-gradient(130deg, ' + savedCustomBg + ', ' + savedCustomBg + ')');
          document.documentElement.style.setProperty('--topbar-text-color', savedCustomText);
          document.documentElement.style.setProperty('--marquee-color', savedCustomText);
          break;

        case 'light':
        default:
          document.documentElement.style.setProperty('--background-color', '#fff');
          document.documentElement.style.setProperty('--text-color', '#000');
          document.documentElement.style.setProperty('--topbar-background', 'linear-gradient(130deg, #0f3443, #34e89e)');
          document.documentElement.style.setProperty('--topbar-text-color', '#fff');
          document.documentElement.style.setProperty('--marquee-color', '#f8f9fa');
          break;
      }
    }

    // 4. Apply the saved mode on load
    applyMode(savedMode);

    // 5. Hook up the custom color pickers
    const customBgInput = document.getElementById('customBgInput');
    const customTextInput = document.getElementById('customTextInput');
    const customApplyBtn = document.getElementById('customApplyBtn');
    const customPicker = document.getElementById('customPicker');

    // Initialize color inputs
    customBgInput.value = savedCustomBg;
    customTextInput.value = savedCustomText;

    // 6. Mode selector
    const modeSelector = document.getElementById('modeSelector');
    if (modeSelector) {
      modeSelector.value = savedMode;
      customPicker.style.display = (savedMode === 'custom') ? 'block' : 'none';

      modeSelector.addEventListener('change', () => {
        const newMode = modeSelector.value;
        localStorage.setItem('churchUiMode', newMode);

        // Show/hide the custom color pickers
        if (newMode === 'custom') {
          customPicker.style.display = 'block';
        } else {
          customPicker.style.display = 'none';
        }
        applyMode(newMode);
      });
    }

    // 7. Listen for "Apply" in custom mode
    customApplyBtn.addEventListener('click', () => {
      const chosenBg = customBgInput.value;
      const chosenText = customTextInput.value;
      localStorage.setItem('churchCustomBg', chosenBg);
      localStorage.setItem('churchCustomText', chosenText);

      // Reapply if currently in custom mode
      if (modeSelector.value === 'custom') {
        applyMode('custom');
      }
    });
</script>
