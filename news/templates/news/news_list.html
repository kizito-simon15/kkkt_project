{% extends 'base.html' %}

{% block content %}
<div style="
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    min-height: 100vh;
    padding: 20px;
    box-sizing: border-box;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    width: 100%;
    max-width: 100vw;
    overflow-x: hidden;
">
    <!-- Header Row with Back Button, Title, and Menu Button -->
    <div style="
        display: flex;
        align-items: center;
        justify-content: space-between;
        width: 100%;
        max-width: 100vw;
        padding: 0 10px;
        box-sizing: border-box;
        gap: 10px;
    ">
        <!-- Back Button -->
        <button onclick="window.history.back()" style="
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(12px, 2.5vw, 14px);
            font-weight: bold;
            color: #007bff;
            padding: 8px 12px;
            border-radius: 20px;
            background: linear-gradient(130deg, #e3f2fd, #bbdefb);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            border: none;
            cursor: pointer;
            transition: background 0.3s ease, transform 0.2s ease;
            white-space: nowrap;
            flex-shrink: 0;
        " onmouseover="this.style.background='linear-gradient(130deg, #bbdefb, #bbdefb)'; this.style.transform='scale(1.05)'" 
          onmouseout="this.style.background='linear-gradient(130deg, #e3f2fd, #bbdefb)'; this.style.transform='scale(1)'">
            <span style="font-size: clamp(16px, 3vw, 20px);">‚¨ÖÔ∏è</span>
        </button>

        <!-- Page Header -->
        <h2 style="
            font-size: clamp(18px, 4vw, 24px);
            font-weight: bold;
            color: #007bff;
            margin: 0;
            text-align: center;
            flex-grow: 1;
            white-space: normal;
        ">
            üì∞ News List
        </h2>

        <!-- Menu Button Partial -->
        {% include 'accounts/partials/menu_button_partial.html' %}
    </div>

    <!-- Create News Button -->
    <a href="{% url 'create_news' %}" style="
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 16px;
        font-weight: bold;
        color: white;
        background-color: #4caf50;
        padding: 10px 15px;
        border-radius: 25px;
        text-decoration: none;
        border: 1px solid #388e3c;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transition: background-color 0.3s ease, transform 0.2s ease;
        margin-top: 15px;
    " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
        <span style="vertical-align: middle; font-size: 20px;">‚ûï</span>
        Create News
    </a>

    {% if news_list %}
        <!-- News List -->
        <div style="width: 100%; max-width: 100vw;">
            {% for news in news_list %}
                <div style="padding: 15px; width: 100%; max-width: 100vw; box-sizing: border-box;">
                    <h3 class="news-title" data-title="{{ news.title }}" data-content="{{ news.content }}" data-news-id="{{ news.pk }}" style="
                        font-size: 22px;
                        font-weight: bold;
                        color: #007bff;
                        cursor: pointer;
                        text-decoration: underline;
                        width: 100%;
                    ">
                        {{ news.title }}
                    </h3>

                    <p class="news-content" data-title="{{ news.title }}" data-content="{{ news.content }}" data-news-id="{{ news.pk }}" style="
                        color: #555;
                        font-size: 18px;
                        line-height: 1.5;
                        cursor: pointer;
                        width: 100%;
                        text-align: justify;
                    ">
                        {{ news.content|truncatewords:40 }} 
                    </p>

                    <!-- Actions: Read More, Edit, Delete -->
                    <div style="display: flex; align-items: center; gap: 15px; margin-top: 10px;">
                        <!-- Read More Button -->
                        <a href="{% url 'news_detail' news.pk %}" style="
                            font-size: 16px;
                            font-weight: bold;
                            color: #007bff;
                            text-decoration: none;
                        ">üìñ Read More...</a>

                        {% if user.is_superuser or user.user_type == "ADMIN" %}
                            <!-- Edit Emoji -->
                            <a href="{% url 'edit_news' news.pk %}" style="
                                font-size: 16px;
                                font-weight: bold;
                                color: #ff9800;
                                text-decoration: none;
                            " title="Edit News">
                                ‚úèÔ∏è
                            </a>

                            <!-- Delete Emoji -->
                            <a href="{% url 'delete_news' news.pk %}" style="
                                font-size: 16px;
                                font-weight: bold;
                                color: #f44336;
                                text-decoration: none;
                            " title="Delete News" onclick="return confirm('Are you sure you want to delete this news?');">
                                üóëÔ∏è
                            </a>
                        {% endif %}
                    </div>

                    <!-- Hidden Documents Section -->
                    <div class="news-documents" data-news-id="{{ news.pk }}" style="display: none;">
                        {% with news.media.all|dictsort:"media_type" as sorted_media %}
                            {% for document in sorted_media %}
                                {% if document.media_type == "document" %}
                                    <a href="{{ document.file.url }}" target="_blank" class="document-link" style="
                                        display: block;
                                        margin-top: 10px;
                                        color: #ff9800;
                                        font-weight: bold;
                                        text-decoration: none;
                                    ">
                                        üìÑ Read Document: {{ document.file.name|slice:"15" }}
                                    </a>
                                {% endif %}
                            {% endfor %}
                        {% endwith %}
                    </div>
                </div>

                <!-- Separator Line -->
                <hr style="border: 0; height: 1px; background: #ccc; margin: 15px 0; width: 100%;">
            {% endfor %}
        </div>
    {% else %}
        <p style="font-size: 18px; color: #555; text-align: center;">No news found.</p>
    {% endif %}
</div>

<!-- Full-Screen News Text Viewer -->
<div id="fullscreen-text-container" style="
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0, 0, 0, 0.9);
    color: white;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    padding: 20px;
    box-sizing: border-box;
    z-index: 1000;
    text-align: center;
    overflow-y: auto;
">
    <span onclick="closeFullScreenText()" style="
        position: absolute;
        top: 20px;
        right: 30px;
        font-size: 40px;
        color: white;
        cursor: pointer;
    ">‚úñ</span>

    <h2 id="fullscreen-title" style="font-size: 26px; font-weight: bold; margin-bottom: 15px;"></h2>
    <p id="fullscreen-content" style="font-size: 18px; line-height: 1.5; text-align: justify; max-width: 800px;"></p>

    <h3 id="document-section-title" style="display: none; font-size: 18px; color: #ff9800; margin-top: 20px;">üìö Read More from These Uploaded Documents:</h3>
    <div id="fullscreen-documents"></div>
</div>

<!-- JavaScript for Full-Screen Text Preview -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const newsTitles = document.querySelectorAll(".news-title, .news-content");
        const fullscreenContainer = document.getElementById("fullscreen-text-container");
        const fullscreenTitle = document.getElementById("fullscreen-title");
        const fullscreenContent = document.getElementById("fullscreen-content");
        const fullscreenDocuments = document.getElementById("fullscreen-documents");
        const documentSectionTitle = document.getElementById("document-section-title");

        newsTitles.forEach(news => {
            news.addEventListener("click", function () {
                fullscreenTitle.innerHTML = this.getAttribute("data-title");
                fullscreenContent.innerHTML = this.getAttribute("data-content");

                const newsId = this.getAttribute("data-news-id");

                // Clear previous document links
                fullscreenDocuments.innerHTML = "";
                documentSectionTitle.style.display = "none";

                // Get and show documents from the hidden section in the template
                const docContainer = document.querySelector(`.news-documents[data-news-id="${newsId}"]`);
                const docLinks = docContainer.innerHTML.trim();

                if (docLinks !== "") {
                    documentSectionTitle.style.display = "block"; // Show section title if documents exist
                    fullscreenDocuments.innerHTML = docLinks;
                }

                fullscreenContainer.style.display = "flex";
            });
        });
    });

    function closeFullScreenText() {
        document.getElementById("fullscreen-text-container").style.display = "none";
    }
</script>
{% endblock %}