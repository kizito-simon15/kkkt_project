{% load static %}

<!-- Groom Selection -->
<h3>üë® Select Groom</h3>

<!-- Search Field -->
<input type="text" id="searchMale" placeholder="üîç Search by Name..."
       style="width: 90%; max-width: 500px; padding: 10px; border: 1px solid #ccc; 
              border-radius: 25px; font-size: 16px; outline: none; 
              box-shadow: inset 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 15px; display: block; margin-left: auto; margin-right: auto;">

<ul id="maleList" style="list-style: none; padding: 0;">
    {% for male in males %}
    <li class="male-item" data-name="{{ male.full_name|lower }}" data-id="{{ male.id }}"
        style="display: flex; align-items: center; justify-content: space-between; padding: 10px; border-bottom: 1px solid #ddd;">
        
        <label style="display: flex; align-items: center; gap: 8px; flex-grow: 1;">
            <input type="checkbox" name="selected_male" value="{{ male.id }}" class="male-checkbox"
                   onclick="toggleMales(this)">
        
            <!-- Handle missing passport image -->
            <img src="{% if male.passport %}{{ male.passport.url }}{% else %}{% static 'images/user.png' %}{% endif %}" 
                 alt="Member Passport"
                 style="width: 40px; height: 40px; border-radius: 50%;">
        
            <span style="display: flex; flex-direction: column;">
                <span style="font-weight: bold;">
                    {{ male.full_name }}
                    <small style="color: #1E90FF;">‚ôÇ(M)</small> <!-- Male Symbol -->
                </span>
                <small style="color: gray;">
                    ({{ male.date_of_birth|date:"Y" }} - Age: {{ male.date_of_birth|timesince }} years)
                </small>
                {% if male.cell %}
                    <small style="color: blue;">
                        ({{ male.cell.name }} - {{ male.cell.outstation.name }})
                    </small>
                {% else %}
                    <small style="color: red;">(No Community)</small>
                {% endif %}
            </span>
        </label>

        <!-- WhatsApp-like Green Tick for Active Members -->
        {% if male.status == "Active" %}
            <span class="active-tick" style="color: #25D366; font-size: 14px; margin-left: 5px; flex-shrink: 0;" title="Active Member">‚úîÔ∏è</span>
        {% endif %}
    </li>
    {% endfor %}
</ul>

<script>
    function filterMales() {
        let searchQuery = document.getElementById("searchMale").value.toLowerCase();
        let males = document.querySelectorAll(".male-item");

        males.forEach(male => {
            let name = male.getAttribute("data-name");
            if (name.includes(searchQuery)) {
                male.style.display = "flex";
            } else {
                male.style.display = "none";
            }
        });
    }

    function toggleMales(selectedCheckbox) {
        let males = document.querySelectorAll(".male-item");

        males.forEach(male => {
            let checkboxInside = male.querySelector(".male-checkbox");
            let tickInside = male.querySelector(".active-tick");

            if (selectedCheckbox.checked) {
                // Hide all unchecked males along with their ticks
                if (checkboxInside !== selectedCheckbox) {
                    male.style.display = "none";
                    if (tickInside) tickInside.style.display = "none"; // Hide tick
                }
            } else {
                // Show all males and their ticks when unchecked
                male.style.display = "flex";
                if (tickInside) tickInside.style.display = "inline"; // Show tick again
            }
        });
    }

    // Attach event listener to filter field
    document.getElementById("searchMale").addEventListener("input", filterMales);
</script>
