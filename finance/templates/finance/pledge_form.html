{% extends "base.html" %}

{% block title %}
Church Pledge Form
{% endblock title %}

{% block styles %}
<style>
  /* Center the form content within the page */
  .pledge-form-wrapper {
    max-width: 600px; /* Adjust as needed */
    margin: 2rem auto; /* Centers the block horizontally & adds top/bottom spacing */
  }

  .form-heading {
    text-align: center;
    font-weight: bold;
    line-height: 1.4;
  }

  .form-heading .sub-title {
    margin-top: 0.5rem;
  }

  .form-group {
    margin-bottom: 1rem;
  }
  .form-group label {
    font-weight: bold;
  }

  /* Ensure consistent width for all fields (text, date, number, select) */
  .form-group input[type="text"],
  .form-group input[type="date"],
  .form-group input[type="number"],
  .form-group select {
    display: block;
    width: 100%;
    max-width: 100%;
    padding: 8px;
    margin-top: 5px;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-size: 14px;
    box-sizing: border-box;
  }

  /* Submit Button */
  button {
    background-color: #28a745; /* Green shade */
    color: #fff;
    border: none;
    padding: 10px 20px;
    border-radius: 4px;
    font-size: 14px;
    cursor: pointer;
  }
  button:hover {
    background-color: #218838;
  }

  /* Django Message Alerts */
  .alert-success {
    background-color: #d4edda;
    color: #155724;
    padding: 10px;
    margin-bottom: 1rem;
    border: 1px solid #c3e6cb;
    border-radius: 4px;
  }
  .alert-danger,
  .alert-error {
    background-color: #f8d7da;
    color: #721c24;
    padding: 10px;
    margin-bottom: 1rem;
    border: 1px solid #f5c6cb;
    border-radius: 4px;
  }

  /* "Back to Home" Button */
  a.btn-secondary {
    display: inline-block;
    margin-top: 1rem;
    text-decoration: none;
    color: #fff;
    background-color: #6c757d;
    padding: 10px 20px;
    border-radius: 4px;
    font-size: 14px;
  }
  a.btn-secondary:hover {
    background-color: #5a6268;
  }

  /* Filter Box Styling */
  #member-filter-group {
    margin-bottom: 1rem; /* Some spacing before the dropdown */
  }

  .footer-note {
    margin-top: 2rem;
    font-size: 0.95rem;
    line-height: 1.4;
  }
</style>
{% endblock styles %}

{% block content %}
<div class="pledge-form-wrapper">
  
  <!-- Heading -->
  <div class="form-heading">
    EVANGELICAL LUTHERAN CHURCH OF TANZANIA - MKWAWA FELLOWSHIP
    <div class="sub-title">PLEDGE FORM</div>
  </div>
  <hr>

  <!-- Display Django Messages -->
  {% if messages %}
    {% for message in messages %}
      <div class="alert {% if message.tags == 'success' %}alert-success{% else %}alert-danger{% endif %}">
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}

  <!-- The Pledge Form -->
  <form method="POST" novalidate>
    {% csrf_token %}

    <!-- 1) Filter Box (JavaScript-based) -->
    <div class="form-group" id="member-filter-group">
      <label for="memberFilter">üîé Filter Members by Name</label>
      <input
        type="text"
        id="memberFilter"
        placeholder="Type here to filter..."
        onkeyup="filterMembers()"
      />
    </div>

    <!-- 2) Church Member Select Field -->
    <div class="form-group">
      <label for="{{ form.member.id_for_label }}">üìå Select Church Member</label>
      {{ form.member }}
    </div>

    <!-- 3) Other Form Fields -->
    <div class="form-group">
      <label for="{{ form.year.id_for_label }}">üìÖ Year</label>
      {{ form.year }}
    </div>

    <div class="form-group">
      <label for="{{ form.month.id_for_label }}">üóìÔ∏è Month</label>
      {{ form.month }}
    </div>

    <div class="form-group">
      <label for="{{ form.date_given.id_for_label }}">üìÜ Date Given</label>
      {{ form.date_given }}
    </div>

    <div class="form-group">
      <label for="{{ form.envelope_number.id_for_label }}">üì© Envelope Number</label>
      {{ form.envelope_number }}
    </div>

    <div class="form-group">
      <label for="{{ form.pledge_amount.id_for_label }}">üí∞ Pledge Amount</label>
      {{ form.pledge_amount }}
    </div>

    <div class="form-group">
      <label for="{{ form.pledge_for_construction.id_for_label }}">üèóÔ∏è Pledge for Construction</label>
      {{ form.pledge_for_construction }}
    </div>

    <!-- Dynamic Button Text -->
    {% if form.instance.pk %}
      <!-- If there's a primary key, we are editing -->
      <button type="submit">üíæ Update Pledge</button>
    {% else %}
      <!-- Otherwise, it's a new pledge -->
      <button type="submit">üíæ Save Pledge</button>
    {% endif %}
  </form>

  <!-- Back to Home Button -->
  <a href="{% url 'pledge_list' %}" class="btn-secondary">üè† Back to List</a>

  <!-- Footer Note -->
  <div class="footer-note">
    <strong>Proverbs 3:9</strong> Honor the LORD with your wealth and with the firstfruits of all your produce,<br>
    For more information, call 0756554389 or 0677975417
  </div>
</div>
{% endblock content %}

{% block scripts %}
{{ block.super }} <!-- Ensures the Google Translate script in base.html still loads -->

<script>
  /**
   * Filters the Church Members dropdown (id_member)
   * by comparing the typed text in memberFilter.
   */
  function filterMembers() {
    const filterBox = document.getElementById("memberFilter");
    const memberSelect = document.getElementById("id_member");

    // If either element doesn't exist, exit gracefully
    if (!filterBox || !memberSelect) {
      return;
    }

    // Get the current filter text (lowercased)
    const filterText = filterBox.value.toLowerCase();

    // Loop through each <option> in the <select>
    for (let i = 0; i < memberSelect.options.length; i++) {
      const optionText = memberSelect.options[i].text.toLowerCase();

      // If the option text includes the filter text, show it; else hide
      memberSelect.options[i].style.display =
        optionText.includes(filterText) ? "" : "none";
    }
  }
</script>
{% endblock scripts %}
