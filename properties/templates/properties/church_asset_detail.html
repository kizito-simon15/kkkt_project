{% extends 'base.html' %}
{% block content %}
<div class="container">
    <!-- Header Row with Back Button, Title, and Menu Button -->
    <div style="
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
        max-width: 100vw;
        padding: 0 10px;
        box-sizing: border-box;
        gap: 10px;
        margin-bottom: 10px;
    ">
        <!-- Back Button -->
        <button onclick="window.history.back()" style="
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(12px, 2.5vw, 14px);
            font-weight: bold;
            color: #007bff;
            padding: 8px 12px;
            border-radius: 20px;
            background: linear-gradient(130deg, #e3f2fd, #bbdefb);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            border: none;
            cursor: pointer;
            transition: background 0.3s ease, transform 0.2s ease;
            white-space: nowrap;
            flex-shrink: 0;
        " onmouseover="this.style.background='linear-gradient(130deg, #bbdefb, #bbdefb)'; this.style.transform='scale(1.05)'" 
          onmouseout="this.style.background='linear-gradient(130deg, #e3f2fd, #bbdefb)'; this.style.transform='scale(1)'">
            <span style="font-size: clamp(16px, 3vw, 20px);">‚¨ÖÔ∏è</span>
        </button>

        <!-- Page Header -->
        <h2 class="header-title" style="
            font-size: clamp(18px, 4vw, 22px);
            font-weight: bold;
            color: #007bff;
            margin: 0;
            text-align: center;
            flex-grow: 1;
            white-space: normal;
        ">
            üìã Church Asset Details
        </h2>

        <!-- Menu Button Partial -->
        {% include 'accounts/partials/menu_button_partial.html' %}
    </div>

    <!-- üõ†Ô∏è Action Buttons (Separate Row) -->
    {% if church_asset.id %}
    <div class="action-icons-container">
        <a href="{% url 'update_church_asset' church_asset.id %}" class="action-icon update-icon" title="Update Asset">‚úèÔ∏è</a>
        <a href="{% url 'delete_church_asset' church_asset.id %}" class="action-icon delete-icon"
           onclick="return confirm('Are you sure you want to delete this asset?');" title="Delete Asset">üóëÔ∏è</a>
        <a href="{% url 'upload_additional_church_asset_media' church_asset.id %}" class="action-icon media-icon" title="Upload Media">üì§</a>
        <a href="{% url 'church_assets_list' %}" class="action-icon list-icon" title="All Assets">üìã</a>
    </div>
    {% endif %}

    <!-- üìå Asset Details -->
    <div class="details-container">
        {% for field, value in asset_details.items %}
        <div class="detail-row">
            <span class="detail-label">{{ field }}</span>
            <span class="detail-value">{{ value }}</span>
        </div>
        <hr> <!-- Separator Line -->
        {% endfor %}
    </div>

    <!-- üì∏ Asset Media -->
    <h3 class="media-title">üì∑ Asset Media</h3>
    <div class="media-gallery">
        {% for media in asset_media %}
            <img src="{{ media.image.url }}" class="preview-image" data-index="{{ forloop.counter0 }}" alt="Asset Image">
        {% empty %}
            <p class="no-media">No media available for this asset.</p>
        {% endfor %}
    </div>

    <!-- üîç Fullscreen Viewer -->
    <div id="fullscreen-viewer" class="fullscreen-hidden">
        <span class="close-btn" onclick="closeFullscreen()">‚úñ</span>
        <img id="fullscreen-image" src="" alt="Fullscreen Image">
        <div class="nav-btn prev-btn" onclick="prevImage()">‚ùÆ</div>
        <div class="nav-btn next-btn" onclick="nextImage()">‚ùØ</div>
    </div>
</div>

<!-- üé® Combined & Updated CSS -->
<style>
    /* ‚úÖ Container Style: minimal top gap for closeness to topbar */
    .container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        width: 100%;
        max-width: 100vw;
        margin: 0 auto;
        padding-top: 40px; /* Smaller top padding to reduce distance from topbar */
        padding-bottom: 30px;
        box-sizing: border-box;
        text-align: center;
    }

    /* ‚úÖ Additional Overwrite for Some Sections if needed to reduce spacing */
    .header-section, .filter-form, .summary-section, .table-container {
        margin-top: 5px;
        padding: 0;
    }
    .header-section h2 {
        margin-bottom: 20px;
    }

    /* üìå Force container minimal spacing on mobile */
    @media only screen and (max-width: 768px) {
        .container {
            padding-top: 5px !important; /* Force override on smaller screens */
        }
    }
    @media only screen and (max-width: 480px) {
        .container {
            padding-top: 20px !important; /* Maintain minimal top margin on smallest phones */
        }
    }

    /* üìå Header Title (Now in Header Row, styles retained) */
    .header-title {
        font-size: 22px;
        font-weight: bold;
        color: #007bff;
    }

    /* üõ†Ô∏è Action Buttons (Separate Row) */
    .action-icons-container {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-bottom: 15px;
    }

    .action-icon {
        font-size: 22px;
        text-decoration: none;
        padding: 8px;
        border-radius: 50%;
        transition: transform 0.2s ease;
    }

    .update-icon {
        background: #ffc107;
        color: black;
    }

    .delete-icon {
        background: #dc3545;
        color: white;
    }

    .media-icon {
        background: #6610f2;
        color: white;
    }

    .list-icon {
        background: #17a2b8;
        color: white;
    }

    .action-icon:hover {
        transform: scale(1.1);
    }

    /* üîπ Asset Details Section */
    .details-container {
        width: 100%;
        max-width: 500px;
        margin: auto;
        text-align: left;
    }

    .detail-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 0;
    }

    .detail-label {
        font-weight: bold;
        color: #444;
    }

    .detail-value {
        color: #007bff;
        font-weight: bold;
        text-align: right;
    }

    hr {
        border: 0;
        height: 1px;
        background: #ddd;
        margin: 5px 0;
    }

    /* üì∏ Media Gallery */
    .media-title {
        font-size: 20px;
        font-weight: bold;
        margin-top: 15px;
    }

    .media-gallery {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: center;
        margin-top: 10px;
    }

    .preview-image {
        width: 100%;
        max-width: 350px;
        height: 350px;
        object-fit: cover;
        border-radius: 10px;
        cursor: pointer;
        transition: transform 0.2s ease;
    }

    .preview-image:hover {
        transform: scale(1.05);
    }

    .no-media {
        font-size: 14px;
        color: #777;
        font-style: italic;
    }

    /* üîç Fullscreen Viewer */
    .fullscreen-hidden {
        display: none;
    }

    #fullscreen-viewer {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.9);
        display: none;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        z-index: 1000;
    }

    #fullscreen-image {
        max-width: 90%;
        max-height: 80vh;
        border-radius: 10px;
        object-fit: contain;
    }

    /* ‚ùå Close Button */
    .close-btn {
        position: absolute;
        top: 20px;
        right: 20px;
        font-size: 30px;
        color: white;
        cursor: pointer;
    }

    /* ‚è™‚è© Navigation Buttons */
    .nav-btn {
        position: absolute;
        top: 50%;
        font-size: 40px;
        color: white;
        cursor: pointer;
        user-select: none;
    }

    .prev-btn {
        left: 10px;
    }

    .next-btn {
        right: 10px;
    }
</style>

<!-- üî• JavaScript for Image Preview -->
<script>
    let currentIndex = 0;
    let images = [];

    document.addEventListener("DOMContentLoaded", function () {
        images = document.querySelectorAll(".preview-image");

        images.forEach((img, index) => {
            img.addEventListener("click", function () {
                openFullscreen(index);
            });
        });

        document.addEventListener("keydown", function (event) {
            if (event.key === "ArrowRight") {
                nextImage();
            } else if (event.key === "ArrowLeft") {
                prevImage();
            } else if (event.key === "Escape") {
                closeFullscreen();
            }
        });
    });

    function openFullscreen(index) {
        currentIndex = index;
        document.getElementById("fullscreen-image").src = images[index].src;
        document.getElementById("fullscreen-viewer").style.display = "flex";
    }

    function closeFullscreen() {
        document.getElementById("fullscreen-viewer").style.display = "none";
    }

    function nextImage() {
        currentIndex = (currentIndex + 1) % images.length;
        document.getElementById("fullscreen-image").src = images[currentIndex].src;
    }

    function prevImage() {
        currentIndex = (currentIndex - 1 + images.length) % images.length;
        document.getElementById("fullscreen-image").src = images[currentIndex].src;
    }
</script>
{% endblock %}