{% if active_inactive_data %}
    <h3>
        Active vs. Inactive Members
        <button id="downloadActiveInactiveChart" style="background: none; border: none; cursor: pointer;">
            ðŸ“¥ Download Graph
        </button>
    </h3>

    <div class="active-inactive-chart-container">
        <canvas id="activeInactivePieChart"></canvas>
    </div>

    <p id="activeInactiveAnalysis"></p>

    <!-- Include Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        .active-inactive-chart-container {
            max-width: 500px;
            height: 400px;
            margin: 0 auto;
        }
        @media screen and (max-width: 600px) {
            .active-inactive-chart-container {
                max-width: 100%;
                height: 400px;
            }
        }
    </style>

    <script>
        // Parse JSON data from Django
        const activeInactiveData = JSON.parse('{{ active_inactive_data|safe }}');

        let activeInactiveChart;

        if (activeInactiveData.labels.length > 0) {
            const ctx = document.getElementById('activeInactivePieChart').getContext('2d');

            activeInactiveChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: activeInactiveData.labels,  // e.g. ["Active", "Inactive"]
                    datasets: [{
                        data: activeInactiveData.data,    // e.g. [10, 5]
                        backgroundColor: [
                            'rgba(54, 162, 235, 0.6)', // Active color
                            'rgba(255, 99, 132, 0.6)'  // Inactive color
                        ],
                        borderColor: [
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 99, 132, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        tooltip: {
                            callbacks: {
                                // Display label, raw count, and percentage
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed || 0; 
                                    const dataArr = context.chart.data.datasets[0].data;
                                    const total = dataArr.reduce((sum, val) => sum + val, 0);
                                    const percentage = ((value / total) * 100).toFixed(2);
                                    return `${label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });

            // Display analysis text (e.g. "There are X active and Y inactive members out of Z total")
            document.getElementById("activeInactiveAnalysis").innerHTML = `<strong>${activeInactiveData.analysis}</strong>`;
        } else {
            document.getElementById("activeInactiveAnalysis").innerHTML = `<p>No member data available.</p>`;
        }

        // Download chart as image
        document.getElementById("downloadActiveInactiveChart").addEventListener("click", function() {
            if (activeInactiveChart) {
                const link = document.createElement('a');
                link.href = document.getElementById('activeInactivePieChart').toDataURL('image/png');
                link.download = 'Active_Inactive_Members_Analysis.png';
                link.click();
            }
        });
    </script>
{% else %}
    <p>No active/inactive data available.</p>
{% endif %}
