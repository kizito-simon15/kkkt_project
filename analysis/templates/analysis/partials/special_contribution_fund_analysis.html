{% if donation_fund_data %}
<h3>
    Special Contributions Fund (Current Year)
    <button id="downloadContributionChart" style="background: none; border: none; cursor: pointer;">
        ðŸ“¥ Download Graph
    </button>
</h3>

<div class="contribution-fund-container">
    <canvas id="specialContributionFundRadarChart"></canvas>
</div>

<p id="specialContributionFundDescription" style="margin-top: 20px;"></p>

<!-- Include Chart.js if not already included -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
  /* Make the radar chart container a bit larger */
  .contribution-fund-container {
    max-width: 700px;
    margin: 0 auto;
    height: 400px; /* Fix a height for consistent vertical space */
  }
  @media screen and (max-width: 600px) {
    .contribution-fund-container {
      max-width: 100%;
      height: 450px; /* Slightly taller on small screens */
    }
  }
</style>

<script>
    // Parse the JSON data from Django
    const donationData = JSON.parse('{{ donation_fund_data|safe }}');

    let contributionChart; // We'll store our Chart.js instance here

    // Check if we have any labels for the radar chart
    if (donationData.labels.length > 0) {
        const ctx = document.getElementById('specialContributionFundRadarChart').getContext('2d');

        contributionChart = new Chart(ctx, {
            type: 'radar',
            data: {
                labels: donationData.labels,   // e.g. ["Renovation", "Charity", ...]
                datasets: [{
                    label: 'Donation Item Fund (TZS)',
                    data: donationData.data,   // e.g. [120000, 75000, ...]
                    backgroundColor: 'rgba(54, 162, 235, 0.6)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,  // fill the container's height
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                },
                scales: {
                    r: {
                        beginAtZero: true
                    }
                }
            }
        });
    }

    // Place the descriptive text
    const descElem = document.getElementById('specialContributionFundDescription');
    descElem.textContent = donationData.description || "No special contributions data for the current year.";

    // Download button logic
    document.getElementById("downloadContributionChart").addEventListener("click", function() {
      if (contributionChart) {
        const link = document.createElement('a');
        link.href = document.getElementById('specialContributionFundRadarChart').toDataURL('image/png');
        link.download = 'Special_Contribution_Fund_Analysis.png';
        link.click();
      }
    });
</script>
{% else %}
<p>No donation item fund data available for the current year.</p>
{% endif %}
