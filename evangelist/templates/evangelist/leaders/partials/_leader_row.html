<!-- _leader_row.html -->
{% load static %}

<tr class="leader-row"
    data-name="{{ leader.church_member.full_name|lower }}"
    data-gender="{{ leader.church_member.gender }}"
    data-occupation="{{ leader.occupation }}"
    data-cell="{{ leader.church_member.cell.id|default:'' }}"
    data-outstation="{{ leader.church_member.cell.outstation.id|default:'' }}"
    style="border-bottom: 1px solid #ddd;">

    <td>{{ counter }}</td>
    <td>{{ leader.leader_id }}</td>

    <td>
        {% if leader.church_member.status == "Active" %}
            <span style="color: green; font-size: 1.2rem;">âœ…</span>
        {% elif leader.church_member.status == "Pending" %}
            <span style="color: orange; font-size: 1.2rem;">â³</span>
        {% else %}
            <span style="color: red; font-size: 1.2rem;">âŒ</span>
        {% endif %}
    </td>

    <td>
        <img
            id="leader-passport-{{ leader.pk }}"
            alt="Passport"
            style="display: none; width: 50px; height: 50px; border-radius: 50%; object-fit: cover;"
            data-passport-url="{% if leader.church_member.passport %}
                                 {{ leader.church_member.passport.url }}
                               {% else %}
                                 {% static 'images/user.png' %}
                               {% endif %}"
        >
    </td>

    <td style="font-weight: bold; font-size: 1rem; white-space: nowrap;">{{ leader.church_member.full_name }}</td>
    <td style="font-size: 1rem; white-space: nowrap;">{{ leader.church_member.gender }}</td>
    <td style="font-size: 1rem; white-space: nowrap;">{{ leader.occupation }}</td>
    <td style="font-size: 1rem; white-space: nowrap;">
        {% if leader.church_member.cell %}
            {{ leader.church_member.cell.name }} ({{ leader.church_member.cell.outstation.name }})
        {% else %}
            Not Assigned
        {% endif %}
    </td>
    <td style="font-size: 1rem; white-space: nowrap;">{{ leader.time_in_service }}</td>

    <td>
        <a href="{% url 'evangelist_leader_detail' leader.pk %}" 
           style="text-decoration: none; padding: 6px 10px; background: #007bff; color: white; border-radius: 5px;">
            ğŸ‘ï¸
        </a>
    </td>
</tr>

<!-- âœ… Inline Styling for Row -->
<style>
    /* ğŸ“Œ Table Row Actions */
    .leader-row td {
        vertical-align: middle;
    }

    /* ğŸ“Œ Action Buttons */
    .leader-row a {
        display: inline-block;
        text-align: center;
        margin-right: 5px;
        font-size: 14px;
        transition: all 0.2s ease-in-out;
    }

    .leader-row a:hover {
        transform: scale(1.1);
    }

    /* âœ… Mobile Optimization */
    @media (max-width: 768px) {
        .leader-row td {
            font-size: 14px;
            padding: 6px;
        }
    }

    @media (max-width: 480px) {
        .leader-row td {
            font-size: 13px;
        }
    }
</style>

<!-- Preload Script for Leader Passport Photos -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Query all leader passport images that have the data-passport-url attribute
    const leaderPics = document.querySelectorAll('img[id^="leader-passport-"][data-passport-url]');

    leaderPics.forEach(imgEl => {
        // Offscreen image to preload
        const hiddenImg = new Image();
        const passportUrl = imgEl.dataset.passportUrl;

        hiddenImg.src = passportUrl;
        hiddenImg.onload = function() {
            // Once fully loaded, set the <img> src and show it
            imgEl.src = passportUrl;
            imgEl.style.display = 'inline';  // or 'block'
        };
    });
});
</script>